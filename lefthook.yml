# Lefthook Git Hooks Configuration
# TDD Enforcement for Forge Workflow
#
# To skip hooks in emergencies:
#   git commit --no-verify  (skip pre-commit)
#   LEFTHOOK=0 git push     (skip pre-push)

commit-msg:
  commands:
    commitlint:
      run: npx commitlint --edit {1}
      tags: commitlint

pre-commit:
  commands:
    tdd-check:
      run: node .forge/hooks/check-tdd.js
      stage_fixed: false
      tags: tdd
      glob: "*.{js,ts,jsx,tsx,py,go,java,rb}"

pre-push:
  commands:
    # 1. Block direct push to main/master (dual-layer protection)
    # Uses Node.js for cross-platform compatibility (Windows, macOS, Linux)
    branch-protection:
      run: node scripts/branch-protection.js
      tags: protection

    # 2. ESLint check (strict mode: blocks on errors and warnings)
    # Uses Node.js script for cross-platform compatibility
    lint:
      run: node scripts/lint.js
      tags: lint

    # 3. Test suite (cross-platform Node.js script detects package manager)
    tests:
      run: node scripts/test.js
      tags: tests
