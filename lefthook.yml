# Lefthook Git Hooks Configuration
# TDD Enforcement for Forge Workflow
#
# To skip hooks in emergencies:
#   git commit --no-verify  (skip pre-commit)
#   LEFTHOOK=0 git push     (skip pre-push)

pre-commit:
  commands:
    tdd-check:
      run: node .forge/hooks/check-tdd.js
      stage_fixed: false
      tags: tdd
      glob: "*.{js,ts,jsx,tsx,py,go,java,rb}"

pre-push:
  commands:
    tests:
      # Detect package manager: bun > pnpm > yarn > npm
      run: |
        if command -v bun >/dev/null 2>&1 && [ -f "bun.lockb" ]; then
          bun test
        elif command -v pnpm >/dev/null 2>&1 && [ -f "pnpm-lock.yaml" ]; then
          pnpm test
        elif command -v yarn >/dev/null 2>&1 && [ -f "yarn.lock" ]; then
          yarn test
        else
          npm test
        fi
      tags: tests
